# Online testing system
Сервис для онлайн тестирования

### Стэк:
- Django==4.0.6
- djangorestframework==3.13.1
- drf-yasg==1.20.0
- psycopg2-binary==2.9.3
- redis==6.2.0
- Docker

### Функционал
Реализовано приложения для онлайн тестирования.
1) Веб приложение на Django.
- Главная страница ```http://127.0.0.1:8060/``` со списком всех доступных тестов. Доступна для всех пользователей.
- Страница с пройденными пользователем тестами  ```http://127.0.0.1:8060/quizzes/completed/```. 
Предоставляет подробную информацию о пройденных тестах. Дает возможность перейти на страницу анализа пройденного теста ```http://127.0.0.1:8060/quizzes/{<int:pk>}/result/```. 
Доступна только авторизованным пользователям.
- Страница детальной информации о пройденном тесте ```http://127.0.0.1:8060/quizzes/{<int:pk>}/result/``` содержит информацию о вопросах, 
верных ответах и ответах данных пользователем, а также % выполнения теста. Доступна только авторизованным пользователям.
- Страница загрузки тестов из CSV ```http://127.0.0.1:8060/upload-csv/```.  Страница с возможностью загрузки тестов из файлов csv с расширенными настройками. 
Доступна только авторизованным пользователям.
2) Реализованна Django management-команда для загрузки csv файлов с тестами.
Базовый импорт:
```commandline
python3 manage.py import_tests /app/data/tests.csv
```
Импорт с обновлением существующих тестов:
```commandline
python3 manage.py import_tests /app/data/tests.csv --update
```
##### Важное примечение!
Так как приложение реализовано в контейнере, то и миграции и менеджмент команды необходимо выполнять в нем.
```commandline
docker exec -it online_testing_system-quizzes_web-1 bash
```
```commandline
python3 manage.py import_tests path/to/tests.csv
```

3) API:
Все эндпоинты API требуют авторизации.
Реализованы следующие эндпоинты:
- ```quizzes/api/v1/``` - Получение списка всех тестов.
- ```quizzes/api/v1/<int:test_id>/``` - Получение теста по ID.
- ```quizzes/api/v1/questions/``` - Получение списка всех вопросов.
- ```quizzes/api/v1/questions/<int:id>/``` - Получение вопроса по ID.
- ```quizzes/api/v1/questions/<int:question_id>/user-answers/``` - Получение ответа на вопрос по id вопроса для запрашивающего пользователя. Для суперюзера доступен доп параметр user_id - позволяющий посмотреть ответ на этот вопрос конкретного пользователя.
- ```quizzes/api/v1/user/tests/``` - Получение результата теста для запрашивающего пользователя. Аналогичный функционал для суперюзера.
- ```quizzes/api/v1/user/tests/<int:test_id>/``` - Получение результатов для конкретного теста по ID. Также по умолчанию предоставляются только те тесты, которые проходил Пользовател. Суперюзер может просматривать чужие результаты.
- ```quizzes/api/v1/save-answer/``` - отправить ответ на вопрос
- ```quizzes/api/v1/submit-test-answers/<int:test_id>/``` - отправить решенный тест.

Для API реализован swagger, доступный по ```http://127.0.0.1:8060/swagger/```

### Инфраструктура.
1) Приложение запускается в Docker контейнере с проброшенным volume для удобства изменений в коде.
2) PostgreSQL также запускается в контейнере с проброшенным volume для сохранения данных.
3) Также в network присутствует Redis контейнер. Его планировал использовать для кэширования прохождения теста, чтобы не терять данные, но это не успел. TODO
4) Есть ENV окружение, но для простоты запуска добавил возможность при отсутствии env брать параметры по умолчанию
5) Специально выбраны нестандартные внешние порты контейнеров
- Для web - 8060
- Для postgres - 5430
Сделано намеренно, на случай, если стандартные порты уже заняты, не приходилось бы останавливать запущенные контейнеры на машине.

### Моковые данные
Также в репозитории доступны CSV файлы с заготовленными тестами:
- other_tests.csv
- only_one_test.csv
- six_tests.csv
- test_with_same_titles.csv
Все они полезны для мануального тестирования приложения. Можно загружать как с помощью веб интерфейса, так и с помощью management-команды.

### Разворачивание приложения
Достаточно клонировать репозиторий себе на машину
и находясь в директории с docker-compose.yml выполнить команду:
```commandline
docker-compose up -d
```
После в контейнере веба
```commandline
docker exec -it online_testing_system-quizzes_web-1 bash
```
Создать и применить миграции:
```commandline
python3 manage.py makemigrations
```
```commandline
python3 manage.py migrate
```
### TODO
- Не успел реализовать логи
- Скромная в целом апишка
- Не успел прикрепить Redis
- Не успел реализовать тип ответа - текстовое поле